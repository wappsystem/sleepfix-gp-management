<div id=D__ID>
	<div id=page__ID>
		<div class="container-fluid" style='max-width:600px'>
			<div class="text-center panel__ID">
                <h3>Welcome to SleepFix.</h3>
                <div class="text-left">
                    <p> You have been invited by your GP to take part in an online research study
                    using a new smartphone application that aims to improve your sleep and daytime functioning.</p>
                    <p>SleepFix is a smartphone application designed to treat insomnia using sleep consolidation therapy.
                    Sleep consolidation therapy works to improve the balance between actual sleep time and the total
                    amount of time spent in bed.</p>
                    <p>The study is for individuals with sleep problems who have been diagnosed with insomnia by their
                    GP, aged over 18 and have access to a smartphone.</p>
                    <p>To determine if you are eligible to participate, you will be asked to complete a short series of
                    questionnaires (X minutes). All eligible participants will receive a Fitbit at no cost.</p>
                    <p>The study will involve using the SleepFix application everyday for 3 weeks, as well as completing a
                    questionnaire at start of the study and 6 weeks later. You will be invited to participate in a follow-up
                    interview about your sleep and use of the app.</p>
                    <p>Your participation in this study is voluntary.</p>
                    <p>If you are interested in participating, please respond to the statement below.</p>
                    <p>I agree on completing a number of screening questionnaires to determine if I am suitable for the
                    study.</p>
                </div>
                <div class="form-group">
                    <div class="questiongroup">
                        <fieldset>
                        <label class="checkboxes">
                            <input type="checkbox" id="i_agree__ID">
                            <span class="check_checkmark"></span> I Agree
                        </label><br>
                        </fieldset>
                    </div>
                </div>
                <div id=login__ID style="display:none" class=C__ID__s>
                    <span style='color:black'>Please enter the unique username and password provided by your GP:</span>
                    <input id=username__ID placeholder="Username" class=C__ID__input autocomplete="off" />
                    &nbsp;&nbsp;<input id=password__ID placeholder="Password" class=C__ID__input type=password />
                    &nbsp;&nbsp;<input id=signin__ID type=button value='Sign in' class=C__ID__button />
                    <br><span id="ErrMsg__ID"></span>
                </div>
			</div>
		</div>
	</div>

    <script>
        function F__ID(){
            //-------------------------------------
            var m=$vm.module_list['__MODULE__'];
            if(m.prefix==undefined) m.prefix="";
            var quest_panel_module="online-questionnaire-panel";
            //-------------------------------------
            $('#username__ID').val('');
            $('#password__ID').val('');
            var search=window.location.search
            if(search.indexOf('username=')!=-1){
                var txt=search.split('username=')[1];
                var username=txt.split('&')[0];
                $('#username__ID').val(username);
            }
            if(search.indexOf('password=')!=-1){
                var txt=search.split('password=')[1];
                var password=txt.split('&')[0];
                $('#password__ID').val(password);
            }
            $('#i_agree__ID').on('click',function(){
                if($('#i_agree__ID:checked').val()=='on') $('#login__ID').show();
                else $('#login__ID').hide();

            });
            $('#D__ID').on('load',function(){
            })
            $('#signin__ID').on('click',function(){
                //------------------------------------
                $('#ErrMsg__ID').text("");
                var username=$('#username__ID').val();
                var password=$('#password__ID').val();
                $vm.request({cmd:"client-signin",table:m.Table,field:'_Password',username:username,password:password},function(res){
                    if(res.status=="np"){
                        $('#ErrMsg__ID').text("Invalid username or password.")
                        return;
                    }
                    if(res.status=="ok"){
                        $vm.user_name=res.sys.username;
                        $vm.set_token(res.sys.token,username);
                        $vm.online_questionnaire=1;
                        $('#vm_username').text('Signed in as '+res.sys.username);
                        //var x = document.getElementById("vm_signout");
                        //x.className="";
                        //--------------------
                        //create a log record, for a special project
                        jQuery.ajaxSetup({async:false});
                        var tb=$vm.module_list["login-data"].Table;
                        $vm.request({cmd:"find-s",table:tb,options:{}},function(res){
                            if(res.result.length==0){
                                var p_uid=username.split('-')[0];
                                var data={Participant:p_uid,Participant_uid:p_uid,sysStatus:"#00FF00"}
                                $vm.request({cmd:'insert',table:tb,data:data},function(res){
                                });
                            }
                        });
                        //--------------------
                        //$vm.load_module(m.questionnaire_panel,'',{record:res.result});
                        var task="";
                        var tb=$vm.module_list['screening-data'].Table;
                        var p_uid=username.split('-')[0];
                        var qry={I2:p_uid};
                        $vm.request({cmd:"find-s",table:tb,query:qry,options:{}},function(res){
                            if(res.result.length==0) task='screening-form';
                            else if (parseInt(res.result[0].Data.phq_9) > 0) task='screen-failure-phq-9';
                            else if (res.result[0].Data.Eligible != "Yes") task='screen-failure-thank-you-page';
                        })
                        if(task==""){
                            tb=$vm.module_list['pis-form'].Table;
                            $vm.request({cmd:"find-s",table:tb,query:qry,options:{}},function(res){
                                if(res.result.length==0) task='pis-form';
                            })
                        }
                        if(task==""){
                            tb=$vm.module_list['consent-form'].Table;
                            $vm.request({cmd:"find-s",table:tb,query:qry,options:{}},function(res){
                                if(res.result.length==0) task='consent-form';
                            })
                        }
                        if(task==""){
                            tb=$vm.module_list['contact-form'].Table;
                            $vm.request({cmd:"find-s",table:tb,query:qry,options:{}},function(res){
                                if(res.result.length==0) task='contact-form';
                            })
                        }
                        if(task==""){
                            tb=$vm.module_list['isi-form'].Table;
                            $vm.request({cmd:"find-s",table:tb,query:qry,options:{}},function(res){
                                if(res.result.length==0) task='isi-form';
                            })
                        }
                        jQuery.ajaxSetup({async:true});
                        if(task!=""){
                            p_uid=username.split('-')[0];
                            $vm.load_module_v2(m.prefix + task, '', {p_uid:p_uid});
                        }
                        else  $vm.load_module_v2(m.prefix + 'success-page', '', {p_uid:p_uid});
                    }
                    else{
                        $('#ErrMsg__ID').text("Invalid username or password.")
                    }
                });
            });
        }
    </script>
    <style>
        #D__ID{
            overflow: auto;
            animation: vm_module_fadein 1.0s;
            /*padding:120px;*/
            height:'unset!important'

        }
        #D__ID h3 {
            font-family: 'Roboto Slab';
            font-size: 24px;
            color: #000;
            letter-spacing: 0;
            display: block;
            padding: 15px;
        }        
        .C__ID__s{
            font: 18pt "Arial";
    /*        padding:80px;*/
            display:inline-block;
            background: rgba(255,255,255,0);
        }
        .panel__ID{
                color:#000;
                background: rgba(255, 255, 255, 0.6);
                border-radius: 15px;
                font-family: 'Nunito Sans';
                padding:20px;
            }
        @media all and (max-width: 480px){
            #D__ID{
                padding:0px;
                height:100%;
            }
            .C__ID__s{
                width:100%;
                height:100%;
                padding:60px 0 0 0;
                text-align: center;
            }
        }
        .C__ID__input{
            height: 34px;
            width:100px;
            color: #555;
            display: inline-block;
            padding: 1px 6px;
            font-size: 10pt;
            background-color: #fff;
            background-image: none;
            border: 1px solid #ccc;
            border-radius: 2px;
            margin-bottom: 0;
        }
        .C__ID__button {
            margin:16px 0;
            -webkit-appearance: button;
            cursor: pointer;
            color: #fff;
            background-color: #428bca;
            border-color: #357ebd;
            display: inline-block;
            padding: 6px 12px;
            font-size: 14px;
            font-weight: 400;
            line-height: 1.42857143;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            background-image: none;
            border: 1px solid transparent;
            border-radius: 4px;
        }
        .C__ID__button:hover{
            background-color: #3276b1;
            border-color: #285e8e;
        }
        .C__ID__s *{
            margin: 6px 0;
        }
        .C__ID__s span{
            color:#FF0000;
            font: 12pt "Arial";
        }
        .C__ID__s u{
            cursor:pointer;
            font: 12pt "Arial";
        }
        #D__ID .checkboxes {
        display: inline-block;
        position: relative;
        cursor: pointer;
        padding-left: 30px;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    #D__ID .checkboxes input {
        position: absolute !important;
        opacity: 0 !important;
        cursor: pointer;
    }
    #D__ID .check_checkmark {
        position: absolute;
        top: 0;
        left: 0;
        height: 22px;
        width: 22px;
        background-color: rgb(255,255,255,0.6);
        border-radius: 0%;
    }
    #D__ID .checkboxes:hover input ~ .check_checkmark {
        background-color: #506A88;
    }
    #D__ID .checkboxes input:checked ~ .check_checkmark {
        background-color: #EA7859;
    }
    #D__ID .check_checkmark:after {
        content: "";
        position: absolute !important;
        display: none;
    }
    /* Show the indicator (dot/circle) when checked */
    #D__ID .checkboxes input:checked ~ .check_checkmark:after {
        display: block !important;
    }
    /* Style the indicator (dot/circle) */
    #D__ID .container-fluid .check_checkmark:after {
        top: 0px;
        left: 6px;
        color:white;
        content:"✔";
    }
/*    #D__ID .form-group .questiongroup {
        margin-left: 15px;
    }
*/
    </style>
</div>
